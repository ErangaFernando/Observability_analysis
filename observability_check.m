function out = observability_check( p,q,vb,w,p1,p2,p3,ranges)
%% This function will calculate the observability rank condition for a given input conditions
% Inputs
% p     : Position
% q     : Orientation
% vb    : Body velocity
% w     : Angular rates
% p1    : Position of beacon 1
% p2    : Position of beacon 2
% p3    : Position of beacon 3

syms x y z qx qy qz qw bx by bz vx vy vz T real % states
syms wx wy wz ft real % Inputs
syms kpa kpp real % drag coefficients
syms m g t real 
syms p1x p1y p1z p3x p2y p2z p3x p3y p3z real

% Assigning values
x = p(1); y = p(2); z = p(3);
qx = q(1); qy = q(2); qz = q(3); qw = q(4);
vx = vb(1); vy = vb(2); vz = vb(3);
wx = w(1); wy = w(2); wz = w(3);

if(ranges == 3)
    p1x = p1(1); p1y = p1(2); p1z = p1(3);
    p2x = p2(1); p2y = p2(2); p2z = p2(3);
    p3x = p3(1); p3y = p3(2); p3z = p3(3);
end

if(ranges == 2)
    p1x = p2(1); p1y = p2(2); p1z = p2(3);
    p2x = p1(1); p2y = p1(2); p2z = p1(3);
end

if(ranges == 1)
    p1x = p2(1); p1y = p2(2); p1z = p2(3);
end
tic
%% Lie derivatives
if (ranges == 3)
H1 = [[       0,       0,       0, 0, 0, 0, 0, -kpp/m,      0,      0,    0];
      [       0,       0,       0, 0, 0, 0, 0,      0, -kpp/m,      0,    0];
      [       0,       0,       0, 0, 0, 0, 0,      0,      0, -kpa/m, -1/m];
      [       0,       0,       1, 0, 0, 0, 0,      0,      0,      0,    0];
      [ x - p1x, y - p1y, z - p1z, 0, 0, 0, 0,      0,      0,      0,    0];
      [ x - p2x, y - p2y, z - p2z, 0, 0, 0, 0,      0,      0,      0,    0];
      [ x - p3x, y - p3y, z - p3z, 0, 0, 0, 0,      0,      0,      0,    0]];
 
GL1f0h = [[                                                                                0,                                                                                0,                                                                                0,                                                                                                             -(2*g*kpp*qz)/m,                                                                                                             -(2*g*kpp*qw)/m,                                                                                                             -(2*g*kpp*qx)/m,                                                                                                               -(2*g*kpp*qy)/m,                                                                                             kpp^2/m^2,                                                                                                     0,                                                                                                     0,       0];
          [                                                                                0,                                                                                0,                                                                                0,                                                                                                              (2*g*kpp*qw)/m,                                                                                                             -(2*g*kpp*qz)/m,                                                                                                             -(2*g*kpp*qy)/m,                                                                                                                (2*g*kpp*qx)/m,                                                                                                     0,                                                                                             kpp^2/m^2,                                                                                                     0,       0];
          [                                                                                0,                                                                                0,                                                                                0,                                                                                                              (2*g*kpa*qx)/m,                                                                                                              (2*g*kpa*qy)/m,                                                                                                             -(2*g*kpa*qz)/m,                                                                                                               -(2*g*kpa*qw)/m,                                                                                                     0,                                                                                                     0,                                                                                             kpa^2/m^2, kpa/m^2];
          [                                                                                0,                                                                                0,                                                                                0,                                                                                                 2*qz*vx - 2*qx*vz - 2*qw*vy,                                                                                                 2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                 2*qx*vx + 2*qy*vy + 2*qz*vz,                                                                                                   2*qw*vz - 2*qx*vy + 2*qy*vx,                                                                                     2*qw*qy + 2*qx*qz,                                                                                     2*qy*qz - 2*qw*qx,                                                                             qw^2 - qx^2 - qy^2 + qz^2,       0];
          [ vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz), vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz), vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz), (p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz), (p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz) - (p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy), (p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz), - (p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx), (p1y - y)*(2*qw*qz - 2*qx*qy) - (p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1z - z)*(2*qw*qy + 2*qx*qz), (p1z - z)*(2*qw*qx - 2*qy*qz) - (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2), (p1x - x)*(2*qw*qy - 2*qx*qz) - (p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1y - y)*(2*qw*qx + 2*qy*qz),       0];
          [ vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz), vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz), vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz), (p2z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p2y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p2x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz), (p2x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p2y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz) - (p2z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy), (p2y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p2x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p2z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz), - (p2x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p2y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p2z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx), (p2y - y)*(2*qw*qz - 2*qx*qy) - (p2x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p2z - z)*(2*qw*qy + 2*qx*qz), (p2z - z)*(2*qw*qx - 2*qy*qz) - (p2x - x)*(2*qw*qz + 2*qx*qy) - (p2y - y)*(qw^2 - qx^2 + qy^2 - qz^2), (p2x - x)*(2*qw*qy - 2*qx*qz) - (p2z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p2y - y)*(2*qw*qx + 2*qy*qz),       0];
          [ vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz), vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz), vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz), (p3z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p3y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p3x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz), (p3x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p3y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz) - (p3z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy), (p3y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p3x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p3z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz), - (p3x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p3y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p3z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx), (p3y - y)*(2*qw*qz - 2*qx*qy) - (p3x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p3z - z)*(2*qw*qy + 2*qx*qz), (p3z - z)*(2*qw*qx - 2*qy*qz) - (p3x - x)*(2*qw*qz + 2*qx*qy) - (p3y - y)*(qw^2 - qx^2 + qy^2 - qz^2), (p3x - x)*(2*qw*qy - 2*qx*qz) - (p3z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p3y - y)*(2*qw*qx + 2*qy*qz),       0]];
 
GL2f0f0h = [[                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qz)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qw)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qx)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qy)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                               -kpp^3/m^3,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                         0];
            [                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpp^2*qw)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qz)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qy)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpp^2*qx)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                               -kpp^3/m^3,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                         0];
            [                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpa^2*qx)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpa^2*qy)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpa^2*qz)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpa^2*qw)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                               -kpa^3/m^3,                                                                                                -kpa^2/m^3];
            [                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qx*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) + 2*qw*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) + 2*qz*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) + 2*g*qw*(2*qw*qx - 2*qy*qz) + 2*g*qz*(2*qw*qy + 2*qx*qz) - 2*g*qx*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qy*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) + 2*qw*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) - 2*qz*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) + 2*g*qw*(2*qw*qy + 2*qx*qz) - 2*g*qz*(2*qw*qx - 2*qy*qz) - 2*g*qy*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qx*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) - 2*qz*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - 2*qy*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) + 2*g*qx*(2*qw*qy + 2*qx*qz) - 2*g*qy*(2*qw*qx - 2*qy*qz) + 2*g*qz*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qx*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) - 2*qw*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) + 2*qy*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) + 2*g*qx*(2*qw*qx - 2*qy*qz) + 2*g*qy*(2*qw*qy + 2*qx*qz) + 2*g*qw*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                             -(kpp*(2*qw*qy + 2*qx*qz))/m,                                                                                                                                                                                                                                                                                                                                                                                                                              (kpp*(2*qw*qx - 2*qy*qz))/m,                                                                                                                                                                                                                                                                                                                                                                                                                     -(kpa*(qw^2 - qx^2 - qy^2 + qz^2))/m,                                                                            -(qw^2 - qx^2 - qy^2 + qz^2)/m];
            [ (2*qw*qy - 2*qx*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qz + 2*qx*qy) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(qw^2 + qx^2 - qy^2 - qz^2), - (2*qw*qx + 2*qy*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qz - 2*qx*qy) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(qw^2 - qx^2 + qy^2 - qz^2), (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qy + 2*qx*qz) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qx - 2*qy*qz) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(qw^2 - qx^2 - qy^2 + qz^2), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) - 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) + 2*g*qw*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)) + 2*g*qx*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)), (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)) - 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qw*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)) + 2*g*qy*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) - 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qx*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)) - 2*g*qy*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qz*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) - 2*g*qw*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)) + 2*g*qx*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qy*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)), 2*(2*qw*qy + 2*qx*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) - 2*(2*qw*qz - 2*qx*qy)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(qw^2 + qx^2 - qy^2 - qz^2) + (kpp*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)))/m, 2*(2*qw*qz + 2*qx*qy)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) - 2*(2*qw*qx - 2*qy*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(qw^2 - qx^2 + qy^2 - qz^2) + (kpp*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)))/m, 2*(2*qw*qx + 2*qy*qz)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) - 2*(2*qw*qy - 2*qx*qz)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)))/m, ((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz))/m];
            [ (2*qw*qy - 2*qx*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qz + 2*qx*qy) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(qw^2 + qx^2 - qy^2 - qz^2), - (2*qw*qx + 2*qy*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qz - 2*qx*qy) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(qw^2 - qx^2 + qy^2 - qz^2), (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qy + 2*qx*qz) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qx - 2*qy*qz) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(qw^2 - qx^2 - qy^2 + qz^2), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) - 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) + 2*g*qw*((p2y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p2x - x)*(2*qw*qz + 2*qx*qy) - (p2z - z)*(2*qw*qx - 2*qy*qz)) + 2*g*qx*((p2z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p2x - x)*(2*qw*qy - 2*qx*qz) + (p2y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p2x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p2y - y)*(2*qw*qz - 2*qx*qy) + (p2z - z)*(2*qw*qy + 2*qx*qz)), (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)) - 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qw*((p2x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p2y - y)*(2*qw*qz - 2*qx*qy) + (p2z - z)*(2*qw*qy + 2*qx*qz)) + 2*g*qy*((p2z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p2x - x)*(2*qw*qy - 2*qx*qz) + (p2y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p2y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p2x - x)*(2*qw*qz + 2*qx*qy) - (p2z - z)*(2*qw*qx - 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) - 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qx*((p2x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p2y - y)*(2*qw*qz - 2*qx*qy) + (p2z - z)*(2*qw*qy + 2*qx*qz)) - 2*g*qy*((p2y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p2x - x)*(2*qw*qz + 2*qx*qy) - (p2z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qz*((p2z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p2x - x)*(2*qw*qy - 2*qx*qz) + (p2y - y)*(2*qw*qx + 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) - 2*g*qw*((p2z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p2x - x)*(2*qw*qy - 2*qx*qz) + (p2y - y)*(2*qw*qx + 2*qy*qz)) + 2*g*qx*((p2y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p2x - x)*(2*qw*qz + 2*qx*qy) - (p2z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qy*((p2x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p2y - y)*(2*qw*qz - 2*qx*qy) + (p2z - z)*(2*qw*qy + 2*qx*qz)), 2*(2*qw*qy + 2*qx*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) - 2*(2*qw*qz - 2*qx*qy)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(qw^2 + qx^2 - qy^2 - qz^2) + (kpp*((p2x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p2y - y)*(2*qw*qz - 2*qx*qy) + (p2z - z)*(2*qw*qy + 2*qx*qz)))/m, 2*(2*qw*qz + 2*qx*qy)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) - 2*(2*qw*qx - 2*qy*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(qw^2 - qx^2 + qy^2 - qz^2) + (kpp*((p2y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p2x - x)*(2*qw*qz + 2*qx*qy) - (p2z - z)*(2*qw*qx - 2*qy*qz)))/m, 2*(2*qw*qx + 2*qy*qz)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) - 2*(2*qw*qy - 2*qx*qz)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*((p2z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p2x - x)*(2*qw*qy - 2*qx*qz) + (p2y - y)*(2*qw*qx + 2*qy*qz)))/m, ((p2z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p2x - x)*(2*qw*qy - 2*qx*qz) + (p2y - y)*(2*qw*qx + 2*qy*qz))/m];
            [ (2*qw*qy - 2*qx*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qz + 2*qx*qy) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(qw^2 + qx^2 - qy^2 - qz^2), - (2*qw*qx + 2*qy*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qz - 2*qx*qy) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(qw^2 - qx^2 + qy^2 - qz^2), (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qy + 2*qx*qz) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qx - 2*qy*qz) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(qw^2 - qx^2 - qy^2 + qz^2), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) - 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) + 2*g*qw*((p3y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p3x - x)*(2*qw*qz + 2*qx*qy) - (p3z - z)*(2*qw*qx - 2*qy*qz)) + 2*g*qx*((p3z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p3x - x)*(2*qw*qy - 2*qx*qz) + (p3y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p3x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p3y - y)*(2*qw*qz - 2*qx*qy) + (p3z - z)*(2*qw*qy + 2*qx*qz)), (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)) - 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qw*((p3x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p3y - y)*(2*qw*qz - 2*qx*qy) + (p3z - z)*(2*qw*qy + 2*qx*qz)) + 2*g*qy*((p3z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p3x - x)*(2*qw*qy - 2*qx*qz) + (p3y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p3y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p3x - x)*(2*qw*qz + 2*qx*qy) - (p3z - z)*(2*qw*qx - 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) - 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qx*((p3x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p3y - y)*(2*qw*qz - 2*qx*qy) + (p3z - z)*(2*qw*qy + 2*qx*qz)) - 2*g*qy*((p3y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p3x - x)*(2*qw*qz + 2*qx*qy) - (p3z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qz*((p3z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p3x - x)*(2*qw*qy - 2*qx*qz) + (p3y - y)*(2*qw*qx + 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) - 2*g*qw*((p3z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p3x - x)*(2*qw*qy - 2*qx*qz) + (p3y - y)*(2*qw*qx + 2*qy*qz)) + 2*g*qx*((p3y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p3x - x)*(2*qw*qz + 2*qx*qy) - (p3z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qy*((p3x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p3y - y)*(2*qw*qz - 2*qx*qy) + (p3z - z)*(2*qw*qy + 2*qx*qz)), 2*(2*qw*qy + 2*qx*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) - 2*(2*qw*qz - 2*qx*qy)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(qw^2 + qx^2 - qy^2 - qz^2) + (kpp*((p3x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p3y - y)*(2*qw*qz - 2*qx*qy) + (p3z - z)*(2*qw*qy + 2*qx*qz)))/m, 2*(2*qw*qz + 2*qx*qy)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) - 2*(2*qw*qx - 2*qy*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(qw^2 - qx^2 + qy^2 - qz^2) + (kpp*((p3y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p3x - x)*(2*qw*qz + 2*qx*qy) - (p3z - z)*(2*qw*qx - 2*qy*qz)))/m, 2*(2*qw*qx + 2*qy*qz)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) - 2*(2*qw*qy - 2*qx*qz)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*((p3z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p3x - x)*(2*qw*qy - 2*qx*qz) + (p3y - y)*(2*qw*qx + 2*qy*qz)))/m, ((p3z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p3x - x)*(2*qw*qy - 2*qx*qz) + (p3y - y)*(2*qw*qx + 2*qy*qz))/m]];
 
 
GL2f0f1h = [[                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qw)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qw)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qz)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qx)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                          2*qx*vy - 2*qw*vz - 2*qy*vx,                                                                                                                                                                                                                                                                                                        - 2*qx*vx - 2*qy*vy - 2*qz*vz,                                                                                                                                                                                                                                                                                                          2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                                                                                                                                                                                                                          2*qz*vx - 2*qx*vz - 2*qw*vy,                                                                                                                                                                                                                             2*qw*qz - 2*qx*qy,                                                                                                                                                                                                                   - qw^2 + qx^2 - qy^2 + qz^2,                                                                                                                                                                                                                           - 2*qw*qx - 2*qy*qz, 0];
            [ (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qz*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 + (qx*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, (qy*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 - (qx*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qw*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 + ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qx*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - (qw*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qz*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, (qy*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 + (qz*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qx*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qw*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qy*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qz*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2, (qw*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 + (qx*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 + (qy*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qz*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, (qx*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qw*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 + (qy*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, 0];
            [ (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 - (qz*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 + (qx*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 + ((p2x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p2y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p2z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vy*(p2y - y) - 2*vx*(p2x - x) + 2*vz*(p2z - z)))/2, (qy*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 - (qx*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qw*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 + ((p2x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p2y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p2z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p2x - x) - 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, (qx*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 - (qw*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 - (qz*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 + ((p2x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p2y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p2z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*vx*(p2x - x) + 2*vy*(p2y - y) - 2*vz*(p2z - z)))/2, (qy*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 + (qz*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qw*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 - ((p2x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p2y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p2z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p2x - x) + 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, (qx*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 - (qw*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 - (qy*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 - (qz*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2, (qw*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 + (qx*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 + (qy*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 - (qz*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2, (qx*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qw*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 + (qy*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 + (qz*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2, 0];
            [ (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 - (qz*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 + (qx*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 + ((p3x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p3y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p3z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vy*(p3y - y) - 2*vx*(p3x - x) + 2*vz*(p3z - z)))/2, (qy*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 - (qx*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qw*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 + ((p3x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p3y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p3z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p3x - x) - 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, (qx*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 - (qw*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 - (qz*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 + ((p3x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p3y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p3z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*vx*(p3x - x) + 2*vy*(p3y - y) - 2*vz*(p3z - z)))/2, (qy*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 + (qz*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qw*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 - ((p3x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p3y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p3z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p3x - x) + 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, (qx*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 - (qw*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 - (qy*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 - (qz*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2, (qw*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 + (qx*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 + (qy*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 - (qz*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2, (qx*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qw*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 + (qy*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 + (qz*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qz)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qy)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                          2*qx*vx + 2*qy*vy + 2*qz*vz,                                                                                                                                                                                                                                                                                                          2*qx*vy - 2*qw*vz - 2*qy*vx,                                                                                                                                                                                                                                                                                                          2*qw*vy + 2*qx*vz - 2*qz*vx,                                                                                                                                                                                                                                                                                                          2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                                                                                                                                     qw^2 + qx^2 - qy^2 - qz^2,                                                                                                                                                                                                                             2*qw*qz + 2*qx*qy,                                                                                                                                                                                                                             2*qx*qz - 2*qw*qy, 0];
            [ (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - (qx*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qw*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, (qz*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qy*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qx*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qy*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 + (qz*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, (qw*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qx*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 + (qz*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qx*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qw*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 + (qy*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 + (qz*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, (qy*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qx*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qw*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qz*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2, (qw*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 + (qy*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qx*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2, 0];
            [ (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 - (qx*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 - (qw*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 - ((p2x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p2y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p2z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*vy*(p2y - y) - 2*vx*(p2x - x) + 2*vz*(p2z - z)))/2, (qz*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 - (qy*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qx*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 + ((p2x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p2y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p2z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p2x - x) - 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, (qy*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 + (qz*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 - (qw*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 + ((p2x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p2y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p2z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p2x - x) + 2*vy*(p2y - y) - 2*vz*(p2z - z)))/2, (qw*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qx*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 + (qz*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 + ((p2x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p2y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p2z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p2x - x) + 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, (qx*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 - (qw*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 + (qy*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 + (qz*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2, (qy*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 - (qx*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 - (qw*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 - (qz*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2, (qw*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 + (qy*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qx*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 + (qz*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2, 0];
            [ (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 - (qx*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 - (qw*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 - ((p3x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p3y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p3z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*vy*(p3y - y) - 2*vx*(p3x - x) + 2*vz*(p3z - z)))/2, (qz*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 - (qy*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qx*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 + ((p3x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p3y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p3z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p3x - x) - 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, (qy*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 + (qz*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 - (qw*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 + ((p3x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p3y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p3z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p3x - x) + 2*vy*(p3y - y) - 2*vz*(p3z - z)))/2, (qw*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qx*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 + (qz*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 + ((p3x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p3y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p3z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p3x - x) + 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, (qx*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 - (qw*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 + (qy*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 + (qz*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2, (qy*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 - (qx*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 - (qw*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 - (qz*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2, (qw*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 + (qy*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qx*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 + (qz*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [ (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qx*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qw*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 + (qz*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qx*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qz*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - (qy*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 + (qx*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qy*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qw*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 + (qx*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qy*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, (qy*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qw*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 + (qx*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2, (qz*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qx*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qy*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qw*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, 0];
            [ (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qx*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 - (qw*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 + (qz*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 - ((p2x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p2y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p2z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vy*(p2y - y) - 2*vx*(p2x - x) + 2*vz*(p2z - z)))/2, ((p2z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qw*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 - ((p2x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p2y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 - (qx*(2*vx*(p2x - x) - 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, (qz*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 - (qy*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 + (qx*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 + ((p2x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p2y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p2z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p2x - x) + 2*vy*(p2y - y) - 2*vz*(p2z - z)))/2, ((p2y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qy*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 - ((p2x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 - ((p2z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p2x - x) + 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, (qw*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 + (qx*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qy*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 + (qz*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2, (qy*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qw*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 + (qx*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 + (qz*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2, (qz*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qx*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 - (qy*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 - (qw*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2, 0];
            [ (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qx*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 - (qw*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 + (qz*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 - ((p3x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p3y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p3z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vy*(p3y - y) - 2*vx*(p3x - x) + 2*vz*(p3z - z)))/2, ((p3z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qw*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 - ((p3x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p3y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 - (qx*(2*vx*(p3x - x) - 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, (qz*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 - (qy*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 + (qx*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 + ((p3x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p3y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p3z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p3x - x) + 2*vy*(p3y - y) - 2*vz*(p3z - z)))/2, ((p3y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qy*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 - ((p3x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 - ((p3z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p3x - x) + 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, (qw*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 + (qx*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qy*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 + (qz*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2, (qy*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qw*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 + (qx*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 + (qz*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2, (qz*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qx*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 - (qy*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 - (qw*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qy)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qx)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qy)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qw)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
            [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                          2*qz*vx - 2*qx*vz - 2*qw*vy,                                                                                                                                                                                                                                                                                                          2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                                                                                                                                                                                                                          2*qx*vx + 2*qy*vy + 2*qz*vz,                                                                                                                                                                                                                                                                                                          2*qw*vz - 2*qx*vy + 2*qy*vx,                                                                                                                                                                                                                             2*qw*qy + 2*qx*qz,                                                                                                                                                                                                                             2*qy*qz - 2*qw*qx,                                                                                                                                                                                                                     qw^2 - qx^2 - qy^2 + qz^2, 0];
            [ (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 + (qx*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, (qw*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qx*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qz*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qy*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, (qy*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qz*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - (qx*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qz*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qy*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qx*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qw*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, (qx*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qw*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qy*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qz*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, (qy*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qx*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qw*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qz*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, 0];
            [ (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, ((p2z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 - (qw*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 - ((p2x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p2y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 + (qx*(2*vy*(p2y - y) - 2*vx*(p2x - x) + 2*vz*(p2z - z)))/2, (qw*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qx*(2*vy*(p2x - x) + 2*vx*(p2y - y)))/2 - (qz*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 + ((p2x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p2y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p2z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p2x - x) - 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, ((p2y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p2x - x) + 2*vx*(p2z - z)))/2 - (qy*(2*vz*(p2y - y) + 2*vy*(p2z - z)))/2 - ((p2x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 - ((p2z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p2x - x) + 2*vy*(p2y - y) - 2*vz*(p2z - z)))/2, (qy*(2*vz*(p2x - x) - 2*vx*(p2z - z)))/2 - (qz*(2*vy*(p2x - x) - 2*vx*(p2y - y)))/2 - (qx*(2*vz*(p2y - y) - 2*vy*(p2z - z)))/2 - ((p2x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p2y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p2z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*vx*(p2x - x) + 2*vy*(p2y - y) + 2*vz*(p2z - z)))/2, (qz*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 - (qy*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qx*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 - (qw*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2, (qx*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qw*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 - (qy*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2 - (qz*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2, (qy*(2*qw*(p2x - x) - 2*qz*(p2y - y) + 2*qy*(p2z - z)))/2 - (qx*(2*qz*(p2x - x) + 2*qw*(p2y - y) - 2*qx*(p2z - z)))/2 - (qw*(2*qx*(p2y - y) - 2*qy*(p2x - x) + 2*qw*(p2z - z)))/2 - (qz*(2*qx*(p2x - x) + 2*qy*(p2y - y) + 2*qz*(p2z - z)))/2, 0];
            [ (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, ((p3z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 - (qw*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 - ((p3x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p3y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 + (qx*(2*vy*(p3y - y) - 2*vx*(p3x - x) + 2*vz*(p3z - z)))/2, (qw*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qx*(2*vy*(p3x - x) + 2*vx*(p3y - y)))/2 - (qz*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 + ((p3x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p3y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p3z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p3x - x) - 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, ((p3y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p3x - x) + 2*vx*(p3z - z)))/2 - (qy*(2*vz*(p3y - y) + 2*vy*(p3z - z)))/2 - ((p3x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 - ((p3z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p3x - x) + 2*vy*(p3y - y) - 2*vz*(p3z - z)))/2, (qy*(2*vz*(p3x - x) - 2*vx*(p3z - z)))/2 - (qz*(2*vy*(p3x - x) - 2*vx*(p3y - y)))/2 - (qx*(2*vz*(p3y - y) - 2*vy*(p3z - z)))/2 - ((p3x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p3y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p3z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*vx*(p3x - x) + 2*vy*(p3y - y) + 2*vz*(p3z - z)))/2, (qz*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 - (qy*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qx*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 - (qw*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2, (qx*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qw*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 - (qy*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2 - (qz*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2, (qy*(2*qw*(p3x - x) - 2*qz*(p3y - y) + 2*qy*(p3z - z)))/2 - (qx*(2*qz*(p3x - x) + 2*qw*(p3y - y) - 2*qx*(p3z - z)))/2 - (qw*(2*qx*(p3y - y) - 2*qy*(p3x - x) + 2*qw*(p3z - z)))/2 - (qz*(2*qx*(p3x - x) + 2*qy*(p3y - y) + 2*qz*(p3z - z)))/2, 0]];
end

if(ranges == 1)
    H1 = [[       0,       0,       0, 0, 0, 0, 0, -kpp/m,      0,      0,    0];
          [       0,       0,       0, 0, 0, 0, 0,      0, -kpp/m,      0,    0];
          [       0,       0,       0, 0, 0, 0, 0,      0,      0, -kpa/m, -1/m];
          [       0,       0,       1, 0, 0, 0, 0,      0,      0,      0,    0];
          [ x - p1x, y - p1y, z - p1z, 0, 0, 0, 0,      0,      0,      0,    0]];
      
    GL1f0h = [[                                                                                0,                                                                                0,                                                                                0,                                                                                                             -(2*g*kpp*qz)/m,                                                                                                             -(2*g*kpp*qw)/m,                                                                                                             -(2*g*kpp*qx)/m,                                                                                                               -(2*g*kpp*qy)/m,                                                                                             kpp^2/m^2,                                                                                                     0,                                                                                                     0,       0];
              [                                                                                0,                                                                                0,                                                                                0,                                                                                                              (2*g*kpp*qw)/m,                                                                                                             -(2*g*kpp*qz)/m,                                                                                                             -(2*g*kpp*qy)/m,                                                                                                                (2*g*kpp*qx)/m,                                                                                                     0,                                                                                             kpp^2/m^2,                                                                                                     0,       0];
              [                                                                                0,                                                                                0,                                                                                0,                                                                                                              (2*g*kpa*qx)/m,                                                                                                              (2*g*kpa*qy)/m,                                                                                                             -(2*g*kpa*qz)/m,                                                                                                               -(2*g*kpa*qw)/m,                                                                                                     0,                                                                                                     0,                                                                                             kpa^2/m^2, kpa/m^2];
              [                                                                                0,                                                                                0,                                                                                0,                                                                                                 2*qz*vx - 2*qx*vz - 2*qw*vy,                                                                                                 2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                 2*qx*vx + 2*qy*vy + 2*qz*vz,                                                                                                   2*qw*vz - 2*qx*vy + 2*qy*vx,                                                                                     2*qw*qy + 2*qx*qz,                                                                                     2*qy*qz - 2*qw*qx,                                                                             qw^2 - qx^2 - qy^2 + qz^2,       0];
              [ vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz), vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz), vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz), (p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz), (p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx) - (p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz) - (p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy), (p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz), - (p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy) - (p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx) - (p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx), (p1y - y)*(2*qw*qz - 2*qx*qy) - (p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1z - z)*(2*qw*qy + 2*qx*qz), (p1z - z)*(2*qw*qx - 2*qy*qz) - (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2), (p1x - x)*(2*qw*qy - 2*qx*qz) - (p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1y - y)*(2*qw*qx + 2*qy*qz),       0]];
    GL2f0f0h = [[                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qz)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qw)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qx)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qy)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                               -kpp^3/m^3,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                         0];
                [                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpp^2*qw)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qz)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpp^2*qy)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpp^2*qx)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                               -kpp^3/m^3,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                         0];
                [                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpa^2*qx)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -(2*g*kpa^2*qy)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpa^2*qz)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (2*g*kpa^2*qw)/m^2,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                               -kpa^3/m^3,                                                                                                -kpa^2/m^3];
                [                                                                                                                                                                                                    0,                                                                                                                                                                                                      0,                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qx*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) + 2*qw*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) + 2*qz*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) + 2*g*qw*(2*qw*qx - 2*qy*qz) + 2*g*qz*(2*qw*qy + 2*qx*qz) - 2*g*qx*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qy*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) + 2*qw*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) - 2*qz*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) + 2*g*qw*(2*qw*qy + 2*qx*qz) - 2*g*qz*(2*qw*qx - 2*qy*qz) - 2*g*qy*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qx*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) - 2*qz*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - 2*qy*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) + 2*g*qx*(2*qw*qy + 2*qx*qz) - 2*g*qy*(2*qw*qx - 2*qy*qz) + 2*g*qz*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2*qx*(g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m) - 2*qw*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) + 2*qy*(g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m) + 2*g*qx*(2*qw*qx - 2*qy*qz) + 2*g*qy*(2*qw*qy + 2*qx*qz) + 2*g*qw*(qw^2 - qx^2 - qy^2 + qz^2),                                                                                                                                                                                                                                                                                                                                                                                                                             -(kpp*(2*qw*qy + 2*qx*qz))/m,                                                                                                                                                                                                                                                                                                                                                                                                                              (kpp*(2*qw*qx - 2*qy*qz))/m,                                                                                                                                                                                                                                                                                                                                                                                                                     -(kpa*(qw^2 - qx^2 - qy^2 + qz^2))/m,                                                                            -(qw^2 - qx^2 - qy^2 + qz^2)/m];
                [ (2*qw*qy - 2*qx*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qz + 2*qx*qy) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(qw^2 + qx^2 - qy^2 - qz^2), - (2*qw*qx + 2*qy*qz)*(T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qz - 2*qx*qy) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(qw^2 - qx^2 + qy^2 - qz^2), (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*qy + 2*qx*qz) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*qx - 2*qy*qz) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(qw^2 - qx^2 - qy^2 + qz^2), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)) - (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) - 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) + 2*g*qw*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)) + 2*g*qx*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)), (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)) - (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)) - 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qw*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)) + 2*g*qy*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)) - 2*g*qz*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)) + (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) - 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qx*vx + 2*qy*vy + 2*qz*vz) - 2*g*qx*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)) - 2*g*qy*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qz*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)), (T/m - g*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*vz)/m)*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)) + (g*(2*qw*qx - 2*qy*qz) + (kpp*vy)/m)*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)) - (g*(2*qw*qy + 2*qx*qz) - (kpp*vx)/m)*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(2*qw*vz - 2*qx*vy + 2*qy*vx) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(2*qw*vy + 2*qx*vz - 2*qz*vx) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(2*qw*vx - 2*qy*vz + 2*qz*vy) - 2*g*qw*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)) + 2*g*qx*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)) - 2*g*qy*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)), 2*(2*qw*qy + 2*qx*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) - 2*(2*qw*qz - 2*qx*qy)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) + 2*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz))*(qw^2 + qx^2 - qy^2 - qz^2) + (kpp*((p1x - x)*(qw^2 + qx^2 - qy^2 - qz^2) - (p1y - y)*(2*qw*qz - 2*qx*qy) + (p1z - z)*(2*qw*qy + 2*qx*qz)))/m, 2*(2*qw*qz + 2*qx*qy)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) - 2*(2*qw*qx - 2*qy*qz)*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz)) + 2*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz))*(qw^2 - qx^2 + qy^2 - qz^2) + (kpp*((p1y - y)*(qw^2 - qx^2 + qy^2 - qz^2) + (p1x - x)*(2*qw*qz + 2*qx*qy) - (p1z - z)*(2*qw*qx - 2*qy*qz)))/m, 2*(2*qw*qx + 2*qy*qz)*(vy*(qw^2 - qx^2 + qy^2 - qz^2) - vx*(2*qw*qz - 2*qx*qy) + vz*(2*qw*qx + 2*qy*qz)) - 2*(2*qw*qy - 2*qx*qz)*(vx*(qw^2 + qx^2 - qy^2 - qz^2) + vy*(2*qw*qz + 2*qx*qy) - vz*(2*qw*qy - 2*qx*qz)) + 2*(vz*(qw^2 - qx^2 - qy^2 + qz^2) + vx*(2*qw*qy + 2*qx*qz) - vy*(2*qw*qx - 2*qy*qz))*(qw^2 - qx^2 - qy^2 + qz^2) + (kpa*((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz)))/m, ((p1z - z)*(qw^2 - qx^2 - qy^2 + qz^2) - (p1x - x)*(2*qw*qy - 2*qx*qz) + (p1y - y)*(2*qw*qx + 2*qy*qz))/m]];
     
     GL2f0f1h = [[                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qw)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qw)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qz)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qx)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                          2*qx*vy - 2*qw*vz - 2*qy*vx,                                                                                                                                                                                                                                                                                                        - 2*qx*vx - 2*qy*vy - 2*qz*vz,                                                                                                                                                                                                                                                                                                          2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                                                                                                                                                                                                                          2*qz*vx - 2*qx*vz - 2*qw*vy,                                                                                                                                                                                                                             2*qw*qz - 2*qx*qy,                                                                                                                                                                                                                   - qw^2 + qx^2 - qy^2 + qz^2,                                                                                                                                                                                                                           - 2*qw*qx - 2*qy*qz, 0];
                 [ (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qz*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 + (qx*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, (qy*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 - (qx*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qw*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 + ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qx*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - (qw*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qz*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, (qy*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 + (qz*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qx*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qw*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qy*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qz*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2, (qw*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 + (qx*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 + (qy*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qz*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, (qx*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qw*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 + (qy*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qz)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qy)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                          2*qx*vx + 2*qy*vy + 2*qz*vz,                                                                                                                                                                                                                                                                                                          2*qx*vy - 2*qw*vz - 2*qy*vx,                                                                                                                                                                                                                                                                                                          2*qw*vy + 2*qx*vz - 2*qz*vx,                                                                                                                                                                                                                                                                                                          2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                                                                                                                                     qw^2 + qx^2 - qy^2 - qz^2,                                                                                                                                                                                                                             2*qw*qz + 2*qx*qy,                                                                                                                                                                                                                             2*qx*qz - 2*qw*qy, 0];
                 [ (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qy*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - (qx*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qw*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, (qz*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qy*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qx*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qy*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 + (qz*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, (qw*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qx*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 + (qz*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qx*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qw*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 + (qy*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 + (qz*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, (qy*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qx*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qw*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qz*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2, (qw*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 + (qy*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qx*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [ (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qx*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2, (qx*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qw*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 + (qz*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qx*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qz*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - (qy*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 + (qx*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qw*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qy*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qw*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 + (qx*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qy*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, (qy*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qw*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 + (qx*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 + (qz*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2, (qz*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qx*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qy*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qw*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qx)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qy)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qw)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpp*qy)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpp*qx)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qx)/m,                                                                                                                                                                                                                                                                                                                       (2*g*kpa*qy)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qz)/m,                                                                                                                                                                                                                                                                                                                      -(2*g*kpa*qw)/m,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0,                                                                                                                                                                                                                                             0, 0];
                 [                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                          2*qz*vx - 2*qx*vz - 2*qw*vy,                                                                                                                                                                                                                                                                                                          2*qw*vx - 2*qy*vz + 2*qz*vy,                                                                                                                                                                                                                                                                                                          2*qx*vx + 2*qy*vy + 2*qz*vz,                                                                                                                                                                                                                                                                                                          2*qw*vz - 2*qx*vy + 2*qy*vx,                                                                                                                                                                                                                             2*qw*qy + 2*qx*qz,                                                                                                                                                                                                                             2*qy*qz - 2*qw*qx,                                                                                                                                                                                                                     qw^2 - qx^2 - qy^2 + qz^2, 0];
                 [ (qw*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qy*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qx*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2, (qw*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qx*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 + (qy*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - (qz*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2, (qw*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qx*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 + (qy*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qz*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2, ((p1z - z)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qz*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qw*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1y - y)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qy*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 + (qx*(2*vy*(p1y - y) - 2*vx*(p1x - x) + 2*vz*(p1z - z)))/2, (qw*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qx*(2*vy*(p1x - x) + 2*vx*(p1y - y)))/2 - (qz*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 + ((p1x - x)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - ((p1y - y)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 - ((p1z - z)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 + (qy*(2*vx*(p1x - x) - 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, ((p1y - y)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - (qx*(2*vz*(p1x - x) + 2*vx*(p1z - z)))/2 - (qy*(2*vz*(p1y - y) + 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - (qw*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - ((p1z - z)*(2*qx*vx + 2*qy*vy + 2*qz*vz))/2 + (qz*(2*vx*(p1x - x) + 2*vy*(p1y - y) - 2*vz*(p1z - z)))/2, (qy*(2*vz*(p1x - x) - 2*vx*(p1z - z)))/2 - (qz*(2*vy*(p1x - x) - 2*vx*(p1y - y)))/2 - (qx*(2*vz*(p1y - y) - 2*vy*(p1z - z)))/2 - ((p1x - x)*(2*qw*vx - 2*qy*vz + 2*qz*vy))/2 - ((p1y - y)*(2*qw*vy + 2*qx*vz - 2*qz*vx))/2 - ((p1z - z)*(2*qw*vz - 2*qx*vy + 2*qy*vx))/2 - (qw*(2*vx*(p1x - x) + 2*vy*(p1y - y) + 2*vz*(p1z - z)))/2, (qz*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qy*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qx*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qw*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, (qx*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qw*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qy*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2 - (qz*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2, (qy*(2*qw*(p1x - x) - 2*qz*(p1y - y) + 2*qy*(p1z - z)))/2 - (qx*(2*qz*(p1x - x) + 2*qw*(p1y - y) - 2*qx*(p1z - z)))/2 - (qw*(2*qx*(p1y - y) - 2*qy*(p1x - x) + 2*qw*(p1z - z)))/2 - (qz*(2*qx*(p1x - x) + 2*qy*(p1y - y) + 2*qz*(p1z - z)))/2, 0]]; 
end
%% Rank conditions
out.O = [H1];
out.O1 = [H1;GL1f0h];
out.O2 = [H1;GL1f0h;GL2f0f0h];
out.O3 = [H1;GL1f0h;GL2f0f1h];

out.H1 = H1;
out.GL1f0h = GL1f0h;
out.GL2f0f0h = GL2f0f0h;
out.GL2f0f1h = GL2f0f1h;


r_O = rank(out.O);
r_O1 = rank(out.O1);
r_O2 = rank(out.O2);
r_O3 = rank(out.O3);

out.ranks = [r_O, r_O1, r_O2, r_O3]';
toc
end

